@namespace UIComponents.DropDownMenu

<CascadingValue Value="@Level" Name="Level">
    <li class="menu-item" @onmouseover="OnMouseEnter" @onmouseout="OnMouseLeave">
        <div class="menu-item-label @(IsOpen ? "menu-item-active" : "")">@Text</div>
        @* <div class="@(IsOpen ? "" : "hidden")">@ChildContent</div> *@
        @if (IsOpen)
        {
            @ChildContent
        }
    </li>
</CascadingValue>

@code {
    [Parameter]
    public String Text { get; set; }

    [CascadingParameter]
    private MenuItems Level { get; set; }

    [Parameter]
    public RenderFragment ChildContent { get; set; }

    private bool IsOpen { get; set; }

    private System.Timers.Timer? closeTimer;

    public void OnMouseEnter()
    {
        // Cancel any pending close action
        closeTimer?.Stop();
        closeTimer = null;
        IsOpen = true;
        StateHasChanged();
    }

    public void OnMouseLeave()
    {
        // Delay closing slightly to allow moving between menu and submenu
        closeTimer = new System.Timers.Timer(150);
        closeTimer.Elapsed += (s, e) =>
        {
            closeTimer?.Stop();
            closeTimer = null;
            IsOpen = false;
            InvokeAsync(StateHasChanged);
        };
        closeTimer.AutoReset = false;
        closeTimer.Start();
    }
}